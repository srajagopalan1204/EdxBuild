<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Sales Order to Pick – Knowledge Check</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 1.5rem;
      line-height: 1.5;
      background: #f7f7fb;
    }
    h1, h2 {
      color: #111827;
    }
    .meta {
      margin-bottom: 1rem;
      padding: 0.75rem 1rem;
      background: #e5e7eb;
      border-radius: 6px;
    }
    .question {
      margin-bottom: 1.75rem;
      padding: 1rem 1.25rem;
      background: #ffffff;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
    }
    .q-text {
      font-weight: 600;
      margin-bottom: 0.5rem;
    }
    label {
      display: block;
      margin: 0.15rem 0;
    }
    button {
      margin-top: 0.4rem;
      margin-right: 0.4rem;
      padding: 0.3rem 0.75rem;
      border-radius: 4px;
      border: 1px solid #4b5563;
      background: #111827;
      color: #ffffff;
      cursor: pointer;
      font-size: 0.9rem;
    }
    button.secondary {
      background: #ffffff;
      color: #111827;
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .feedback {
      margin-top: 0.4rem;
      font-size: 0.85rem;
      color: #065f46;
    }
    .feedback.error {
      color: #b91c1c;
    }
    #scoreSummary {
      font-weight: 600;
      margin-top: 0.5rem;
      margin-bottom: 0.75rem;
    }
    .footer-actions {
      margin-top: 1.5rem;
      padding-top: 1rem;
      border-top: 1px solid #d1d5db;
    }
    input[type="text"] {
      padding: 0.25rem 0.4rem;
      margin-right: 0.5rem;
      border-radius: 4px;
      border: 1px solid #9ca3af;
    }
  </style>
</head>
<body>
  <h1>Sales Order to Pick SOP – Knowledge Check</h1>

  <div class="meta">
    <p>
      Please complete this quiz after you have gone through the Sales Order to Pick SOP training module.
      You may answer each question up to <strong>two times</strong>. Your attempts and timestamps
      will be captured in a CSV log you can download at the end.
    </p>
  </div>

  <section>
    <h2>Learner Information</h2>
    <p>
      <label>
        Your Name:
        <input type="text" id="learnerName" placeholder="Type your name">
      </label>
      <label>
        Location / Branch:
        <input type="text" id="location" placeholder="e.g. Greensburg">
      </label>
    </p>
  </section>

  <section id="quiz">
    <h2>Quiz Questions</h2>

    <!-- Q1 -->
    <div class="question" data-qid="q1">
      <p class="q-text">
        <strong>Q1.</strong> The main purpose of the <em>Sales Order to Pick</em> SOP is to:
      </p>
      <label><input type="radio" name="q1" value="0"> A. Print customer statements for month-end</label>
      <label><input type="radio" name="q1" value="1"> B. Add and maintain items on a stock customer sales order, review totals, finish the order, and move it to picking and invoicing</label>
      <label><input type="radio" name="q1" value="2"> C. Adjust on-hand inventory quantities for the warehouse</label>
      <label><input type="radio" name="q1" value="3"> D. Enter and approve vendor invoices</label>
      <div>
        <button type="button" onclick="submitQuestion('q1')">Submit Answer</button>
        <button type="button" class="secondary" onclick="redoQuestion('q1')">Redo Question</button>
      </div>
      <div class="feedback" id="feedback-q1"></div>
    </div>

    <!-- Q2 -->
    <div class="question" data-qid="q2">
      <p class="q-text">
        <strong>Q2.</strong> You need to work with an existing stock customer sales order in the training environment.
        Which navigation path do you use to reach Order Entry?
      </p>
      <label><input type="radio" name="q2" value="0"> A. Menu → Inventory → Adjustment → Order</label>
      <label><input type="radio" name="q2" value="1"> B. Menu → Sales → Entry → Order</label>
      <label><input type="radio" name="q2" value="2"> C. Menu → Finance → Accounts Receivable → Customer</label>
      <label><input type="radio" name="q2" value="3"> D. Menu → Warehouse → Picking → Order</label>
      <div>
        <button type="button" onclick="submitQuestion('q2')">Submit Answer</button>
        <button type="button" class="secondary" onclick="redoQuestion('q2')">Redo Question</button>
      </div>
      <div class="feedback" id="feedback-q2"></div>
    </div>

    <!-- Q3 -->
    <div class="question" data-qid="q3">
      <p class="q-text">
        <strong>Q3.</strong> Once you are on the Order Entry screen for stock customer orders, what is the correct sequence
        to open an existing order to add or review lines?
      </p>
      <label><input type="radio" name="q3" value="0"> A. Click Order Type, select Blanket Order, then click Submit</label>
      <label><input type="radio" name="q3" value="1"> B. Click Order Number, enter the order number (for example, 8567-00), select the order, then click Next</label>
      <label><input type="radio" name="q3" value="2"> C. Click Customer, search by name, then click Finish</label>
      <label><input type="radio" name="q3" value="3"> D. Click Menu, then Exit and start over</label>
      <div>
        <button type="button" onclick="submitQuestion('q3')">Submit Answer</button>
        <button type="button" class="secondary" onclick="redoQuestion('q3')">Redo Question</button>
      </div>
      <div class="feedback" id="feedback-q3"></div>
    </div>

    <!-- Q4 -->
    <div class="question" data-qid="q4">
      <p class="q-text">
        <strong>Q4.</strong> When adding items to a stock customer sales order, which of the following
        steps is part of the documented procedure?
      </p>
      <label><input type="radio" name="q4" value="0"> A. Enter the product number, choose the correct item, enter the quantity, then click Add</label>
      <label><input type="radio" name="q4" value="1"> B. Enter the product number and immediately click Finish</label>
      <label><input type="radio" name="q4" value="2"> C. Enter the product number, then switch to the Inventory module</label>
      <label><input type="radio" name="q4" value="3"> D. Enter the quantity first, then search for the product</label>
      <div>
        <button type="button" onclick="submitQuestion('q4')">Submit Answer</button>
        <button type="button" class="secondary" onclick="redoQuestion('q4')">Redo Question</button>
      </div>
      <div class="feedback" id="feedback-q4"></div>
    </div>

    <!-- Q5 -->
    <div class="question" data-qid="q5">
      <p class="q-text">
        <strong>Q5.</strong> When should you review <em>Taxes &amp; Totals</em> on a stock customer sales order?
      </p>
      <label><input type="radio" name="q5" value="0"> A. Before any items are added</label>
      <label><input type="radio" name="q5" value="1"> B. Only if the customer asks about taxes</label>
      <label><input type="radio" name="q5" value="2"> C. After entering the order lines and before submitting and finishing the order</label>
      <label><input type="radio" name="q5" value="3"> D. After the pick ticket has already printed</label>
      <div>
        <button type="button" onclick="submitQuestion('q5')">Submit Answer</button>
        <button type="button" class="secondary" onclick="redoQuestion('q5')">Redo Question</button>
      </div>
      <div class="feedback" id="feedback-q5"></div>
    </div>

    <!-- Q6 -->
    <div class="question" data-qid="q6">
      <p class="q-text">
        <strong>Q6.</strong> On the Taxes &amp; Totals screen, which areas do you use to review
        addons (such as freight or fees) and discounts?
      </p>
      <label><input type="radio" name="q6" value="0"> A. The Order Type field and the Customer field</label>
      <label><input type="radio" name="q6" value="1"> B. The Addons option and the Discounts option on the Taxes &amp; Totals screen</label>
      <label><input type="radio" name="q6" value="2"> C. The Inventory module and the Pricing module</label>
      <label><input type="radio" name="q6" value="3"> D. The Ship To section and the Bill To section</label>
      <div>
        <button type="button" onclick="submitQuestion('q6')">Submit Answer</button>
        <button type="button" class="secondary" onclick="redoQuestion('q6')">Redo Question</button>
      </div>
      <div class="feedback" id="feedback-q6"></div>
    </div>

    <!-- Q7 -->
    <div class="question" data-qid="q7">
      <p class="q-text">
        <strong>Q7.</strong> When you are creating a blanket order for a customer, which
        Order Type do you select in the Order Entry header?
      </p>
      <label><input type="radio" name="q7" value="0"> A. Stock Order</label>
      <label><input type="radio" name="q7" value="1"> B. Direct Ship</label>
      <label><input type="radio" name="q7" value="2"> C. Blanket Order</label>
      <label><input type="radio" name="q7" value="3"> D. Return</label>
      <div>
        <button type="button" onclick="submitQuestion('q7')">Submit Answer</button>
        <button type="button" class="secondary" onclick="redoQuestion('q7')">Redo Question</button>
      </div>
      <div class="feedback" id="feedback-q7"></div>
    </div>

    <!-- Q8 -->
    <div class="question" data-qid="q8">
      <p class="q-text">
        <strong>Q8.</strong> True or False: When creating a blanket order, the procedure instructs you
        to uncheck <em>Print Line Price</em> and check <em>Lump Sum Bill</em> before submitting the order.
      </p>
      <label><input type="radio" name="q8" value="0"> A. True</label>
      <label><input type="radio" name="q8" value="1"> B. False</label>
      <div>
        <button type="button" onclick="submitQuestion('q8')">Submit Answer</button>
        <button type="button" class="secondary" onclick="redoQuestion('q8')">Redo Question</button>
      </div>
      <div class="feedback" id="feedback-q8"></div>
    </div>

    <!-- Q9 -->
    <div class="question" data-qid="q9">
      <p class="q-text">
        <strong>Q9.</strong> In the overall process flow, what must happen when a sales order
        is placed on credit hold and the issue is not resolved?
      </p>
      <label><input type="radio" name="q9" value="0"> A. The order is automatically shipped without review</label>
      <label><input type="radio" name="q9" value="1"> B. The system converts the order to a blanket order</label>
      <label><input type="radio" name="q9" value="2"> C. Sales is informed to cancel the order and update the reason, under manager guidance</label>
      <label><input type="radio" name="q9" value="3"> D. The warehouse prints the pick ticket anyway</label>
      <div>
        <button type="button" onclick="submitQuestion('q9')">Submit Answer</button>
        <button type="button" class="secondary" onclick="redoQuestion('q9')">Redo Question</button>
      </div>
      <div class="feedback" id="feedback-q9"></div>
    </div>

    <!-- Q10 -->
    <div class="question" data-qid="q10">
      <p class="q-text">
        <strong>Q10.</strong> Which step marks the hand-off from this SOP to the next SOP (Pick to Invoice)
        in the end-to-end process?
      </p>
      <label><input type="radio" name="q10" value="0"> A. S3 – Review Taxes and Totals</label>
      <label><input type="radio" name="q10" value="1"> B. S5 – Create Blanket or Fulfillment Order</label>
      <label><input type="radio" name="q10" value="2"> C. S7 – Print Customer Acknowledgement and Pick Ticket</label>
      <label><input type="radio" name="q10" value="3"> D. S8 – Proceed to the Pick to Invoice SOP</label>
      <div>
        <button type="button" onclick="submitQuestion('q10')">Submit Answer</button>
        <button type="button" class="secondary" onclick="redoQuestion('q10')">Redo Question</button>
      </div>
      <div class="feedback" id="feedback-q10"></div>
    </div>
  </section>

  <section class="footer-actions">
    <p id="scoreSummary">Score will appear here after you submit at least one question.</p>
    <button type="button" onclick="calculateScore()">Calculate Score</button>
    <button type="button" onclick="downloadCsv()">Download Attempt Log (CSV)</button>
  </section>

  <script>
    // Global tracking
    const quizStart = new Date().toISOString();
    const questionIds = ["q1","q2","q3","q4","q5","q6","q7","q8","q9","q10"];
    const maxAttempts = 2;

    // Correct answers: index corresponds to the value attribute on each radio button
    const correctAnswers = {
      q1: 1,  // B
      q2: 1,  // B
      q3: 1,  // B
      q4: 0,  // A
      q5: 2,  // C
      q6: 1,  // B
      q7: 2,  // C
      q8: 0,  // True
      q9: 2,  // C
      q10: 3  // D
    };

    // Structure: { qid: { attempts: [ {...}, ... ], currentAttempt: {...}|null } }
    const responseLog = {};

    // Attach change listeners to all radios to capture start time / answer index
    document.querySelectorAll('input[type="radio"]').forEach(input => {
      input.addEventListener('change', handleOptionChange);
    });

    function handleOptionChange(event) {
      const qid = event.target.name;
      const answerIndex = parseInt(event.target.value, 10);
      const now = new Date().toISOString();

      if (!responseLog[qid]) {
        responseLog[qid] = { attempts: [], currentAttempt: null };
      }
      const qEntry = responseLog[qid];

      // If both attempts already used and no current attempt, do not allow changes
      if (!qEntry.currentAttempt && qEntry.attempts.length >= maxAttempts) {
        event.target.checked = false;
        const fb = document.getElementById(`feedback-${qid}`);
        if (fb) {
          fb.classList.add("error");
          fb.textContent = "You have already used both attempts for this question.";
        }
        return;
      }

      if (!qEntry.currentAttempt) {
        // Start a new attempt
        qEntry.currentAttempt = {
          attemptNumber: qEntry.attempts.length + 1,
          startedAt: now,
          finishedAt: null,
          answerIndex: answerIndex,
          isCorrect: null
        };
      } else {
        // Update the chosen answer within the same attempt
        qEntry.currentAttempt.answerIndex = answerIndex;
      }
    }

    function submitQuestion(qid) {
      const now = new Date().toISOString();
      if (!responseLog[qid]) {
        responseLog[qid] = { attempts: [], currentAttempt: null };
      }
      const qEntry = responseLog[qid];
      const fb = document.getElementById(`feedback-${qid}`);

      // Ensure there is a selection
      const selected = document.querySelector(`input[name="${qid}"]:checked`);
      if (!selected) {
        if (fb) {
          fb.classList.add("error");
          fb.textContent = "Please select an answer before submitting.";
        }
        return;
      }

      // If no current attempt, create one from the selected answer
      if (!qEntry.currentAttempt) {
        if (qEntry.attempts.length >= maxAttempts) {
          if (fb) {
            fb.classList.add("error");
            fb.textContent = "You have already used both attempts for this question.";
          }
          return;
        }
        qEntry.currentAttempt = {
          attemptNumber: qEntry.attempts.length + 1,
          startedAt: now,
          finishedAt: null,
          answerIndex: parseInt(selected.value, 10),
          isCorrect: null
        };
      }

      const attempt = qEntry.currentAttempt;

      if (attempt.finishedAt) {
        if (fb) {
          fb.classList.add("error");
          fb.textContent = "This attempt has already been submitted.";
        }
        return;
      }

      attempt.finishedAt = now;
      attempt.isCorrect = (attempt.answerIndex === correctAnswers[qid]);
      qEntry.attempts.push(attempt);
      qEntry.currentAttempt = null;

      // Feedback
      if (fb) {
        fb.classList.remove("error");
        const attemptLabel = attempt.attemptNumber === 1 ? "First attempt" : "Second attempt";
        fb.textContent = `${attemptLabel}: ${attempt.isCorrect ? "Correct" : "Incorrect"} (started ${attempt.startedAt}, finished ${attempt.finishedAt}).`;
        if (qEntry.attempts.length >= maxAttempts) {
          fb.textContent += " You have used both attempts for this question.";
        }
      }

      // Optionally recalc score each submit
      calculateScore();
    }

    function redoQuestion(qid) {
      const qEntry = responseLog[qid];
      const fb = document.getElementById(`feedback-${qid}`);

      if (!qEntry || qEntry.attempts.length === 0) {
        if (fb) {
          fb.classList.add("error");
          fb.textContent = "You must submit the question once before redoing it.";
        }
        return;
      }

      if (qEntry.attempts.length >= maxAttempts) {
        if (fb) {
          fb.classList.add("error");
          fb.textContent = "You have already used your redo for this question.";
        }
        return;
      }

      // Clear selection
      document.querySelectorAll(`input[name="${qid}"]`).forEach(input => {
        input.checked = false;
      });

      qEntry.currentAttempt = null;

      if (fb) {
        fb.classList.remove("error");
        fb.textContent = "You may redo this question now. Make a new selection and click Submit Answer.";
      }
    }

    function calculateScore() {
      let correctCount = 0;
      let totalCount = questionIds.length;

      questionIds.forEach(qid => {
        const qEntry = responseLog[qid];
        if (!qEntry || qEntry.attempts.length === 0) {
          return;
        }
        const lastAttempt = qEntry.attempts[qEntry.attempts.length - 1];
        if (lastAttempt.isCorrect) {
          correctCount += 1;
        }
      });

      const scoreEl = document.getElementById("scoreSummary");
      if (scoreEl) {
        scoreEl.textContent = `Current score (based on your latest attempt for each question): ${correctCount} / ${totalCount}`;
      }
    }

    function downloadCsv() {
      const learnerName = (document.getElementById("learnerName").value || "").replace(/"/g, '""');
      const location = (document.getElementById("location").value || "").replace(/"/g, '""');
      const now = new Date().toISOString();

      const lines = [];
      lines.push('Quiz Name,"Sales Order to Pick SOP – Knowledge Check"');
      lines.push(`Learner Name,"${learnerName}"`);
      lines.push(`Location,"${location}"`);
      lines.push(`Quiz Start,"${quizStart}"`);
      lines.push(`Log Generated At,"${now}"`);
      lines.push("");
      lines.push("Question ID,Question Text,Attempt #,Started At,Finished At,Answer Index,Answer Text,Correct?");

      questionIds.forEach(qid => {
        const qEntry = responseLog[qid];
        if (!qEntry || !qEntry.attempts || qEntry.attempts.length === 0) {
          return;
        }

        const qContainer = document.querySelector(`.question[data-qid="${qid}"]`);
        let qText = "";
        if (qContainer) {
          const qTextEl = qContainer.querySelector(".q-text");
          if (qTextEl) {
            qText = qTextEl.innerText.trim().replace(/"/g, '""');
          }
        }

        qEntry.attempts.forEach(att => {
          let answerText = "";
          const radio = document.querySelector(`input[name="${qid}"][value="${att.answerIndex}"]`);
          if (radio && radio.parentElement) {
            answerText = radio.parentElement.textContent.trim().replace(/"/g, '""');
          }
          const correctLabel = att.isCorrect ? "Yes" : "No";
          lines.push(
            `"${qid}","${qText}",${att.attemptNumber},` +
            `"${att.startedAt || ""}","${att.finishedAt || ""}",` +
            `${att.answerIndex},"${answerText}",${correctLabel}`
          );
        });
      });

      const csvContent = lines.join("\n");
      const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "Sales_Order_to_Pick_Quiz_Attempts.csv";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
